<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Truppers - Futuristic Membership</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --primary: #00ffcc;
  --secondary: #7b2cff;
  --accent: #ff4d4d;
  --dark: #0a0a14;
  --darker: #050510;
  --light: #ffffff;
  --gray: #a0a0c0;
  --glass: rgba(20, 20, 40, 0.7);
  --glass-border: rgba(100, 255, 255, 0.2);
  --shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  --neon-glow: 0 0 15px var(--primary);
  --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

* { 
  box-sizing: border-box; 
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', 'Roboto', system-ui, sans-serif;
  min-height: 100vh;
  background: 
    radial-gradient(circle at 20% 30%, rgba(123, 44, 255, 0.15) 0%, transparent 40%),
    radial-gradient(circle at 80% 70%, rgba(0, 255, 204, 0.1) 0%, transparent 40%),
    var(--darker) url("image.jpg") center/cover no-repeat fixed;
  color: var(--light);
  position: relative;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(45deg, rgba(5, 5, 16, 0.9) 0%, rgba(10, 10, 20, 0.85) 100%);
  z-index: -1;
}

.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
  position: relative;
  z-index: 1;
}

.header {
  text-align: center;
  margin: 40px 0 60px;
}

.header h1 {
  font-size: 4.5rem;
  font-weight: 800;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-transform: uppercase;
  letter-spacing: 3px;
  margin-bottom: 20px;
  position: relative;
  display: inline-block;
}

.header h1::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 200px;
  height: 4px;
  background: linear-gradient(90deg, transparent, var(--primary), transparent);
  border-radius: 2px;
}

.subtitle {
  font-size: 1.2rem;
  color: var(--gray);
  max-width: 600px;
  margin: 0 auto;
  line-height: 1.6;
}

.section {
  background: var(--glass);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  border: 1px solid var(--glass-border);
  padding: 40px;
  margin-bottom: 40px;
  box-shadow: var(--shadow);
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
}

.section:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
}

.guide-content {
  max-height: 300px;
  overflow-y: auto;
  padding-right: 15px;
  margin-bottom: 40px;
}

.guide-content::-webkit-scrollbar {
  width: 8px;
}

.guide-content::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
}

.guide-content::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 10px;
}

.guide-title {
  font-size: 1.8rem;
  margin-bottom: 25px;
  color: var(--primary);
  display: flex;
  align-items: center;
  gap: 10px;
}

.guide-title i {
  font-size: 1.5rem;
}

.guide-list {
  list-style: none;
  margin: 25px 0;
}

.guide-list li {
  margin-bottom: 15px;
  padding-left: 30px;
  position: relative;
  line-height: 1.6;
}

.guide-list li::before {
  content: '▸';
  position: absolute;
  left: 0;
  color: var(--primary);
  font-size: 1.2rem;
}

.buttons-container {
  display: flex;
  gap: 20px;
  justify-content: center;
  margin-top: 30px;
}

.btn {
  padding: 18px 35px;
  border-radius: 12px;
  border: none;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  min-width: 180px;
  letter-spacing: 1px;
  position: relative;
  overflow: hidden;
  z-index: 1;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.7s;
  z-index: -1;
}

.btn:hover::before {
  left: 100%;
}

.btn-agree {
  background: linear-gradient(135deg, var(--primary), #00ccaa);
  color: var(--dark);
  box-shadow: 0 5px 15px rgba(0, 255, 204, 0.3);
}

.btn-agree:hover {
  background: linear-gradient(135deg, #00ccaa, var(--primary));
  box-shadow: var(--neon-glow);
  transform: translateY(-3px);
}

.btn-cancel {
  background: linear-gradient(135deg, var(--accent), #cc3d3d);
  color: white;
  box-shadow: 0 5px 15px rgba(255, 77, 77, 0.3);
}

.btn-cancel:hover {
  background: linear-gradient(135deg, #cc3d3d, var(--accent));
  box-shadow: 0 0 15px var(--accent), 0 0 25px rgba(255, 77, 77, 0.5);
  transform: translateY(-3px);
}

.btn-submit {
  width: 100%;
  background: linear-gradient(135deg, var(--secondary), #5a1cb3);
  color: white;
  margin-top: 20px;
  box-shadow: 0 5px 15px rgba(123, 44, 255, 0.3);
}

.btn-submit:hover {
  background: linear-gradient(135deg, #5a1cb3, var(--secondary));
  box-shadow: 0 0 15px var(--secondary), 0 0 25px rgba(123, 44, 255, 0.5);
}

.btn-upload {
  width: 100%;
  background: linear-gradient(135deg, #25D366, #1da851);
  color: white;
  margin-top: 20px;
}

.btn-upload:hover {
  background: linear-gradient(135deg, #1da851, #25D366);
  box-shadow: 0 0 15px #25D366, 0 0 25px rgba(37, 211, 102, 0.5);
}

.btn-whatsapp {
  width: 100%;
  background: linear-gradient(135deg, #25D366, #1da851);
  color: white;
  font-size: 1.5rem;
  padding: 25px;
  box-shadow: 0 5px 20px rgba(37, 211, 102, 0.4);
}

.btn-whatsapp:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(37, 211, 102, 0.6);
}

.form-group {
  margin-bottom: 30px;
  position: relative;
}

.input-label {
  display: block;
  margin-bottom: 8px;
  color: var(--primary);
  font-weight: 500;
  font-size: 1.1rem;
}

.input-field {
  width: 100%;
  padding: 18px 15px;
  background: transparent;
  border: none;
  border-bottom: 2px solid rgba(255, 255, 255, 0.1);
  color: white;
  font-size: 1.1rem;
  transition: var(--transition);
}

.input-field:focus {
  outline: none;
  border-bottom-color: var(--primary);
  box-shadow: 0 5px 15px rgba(0, 255, 204, 0.1);
}

.input-field::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.input-highlight {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 2px;
  width: 0;
  background: var(--primary);
  transition: width 0.4s ease;
}

.input-field:focus + .input-highlight {
  width: 100%;
}

.file-upload {
  border: 2px dashed rgba(255, 255, 255, 0.2);
  border-radius: 15px;
  padding: 40px 20px;
  text-align: center;
  transition: var(--transition);
  cursor: pointer;
  margin-bottom: 30px;
}

.file-upload:hover {
  border-color: var(--primary);
  background: rgba(0, 255, 204, 0.05);
}

.file-upload i {
  font-size: 3rem;
  color: var(--primary);
  margin-bottom: 15px;
}

.file-upload p {
  color: var(--gray);
  margin-bottom: 10px;
}

.file-input {
  display: none;
}

.file-name {
  margin-top: 15px;
  color: var(--primary);
  font-weight: 500;
  word-break: break-all;
}

.image-preview {
  width: 200px;
  height: 200px;
  border-radius: 15px;
  object-fit: cover;
  border: 2px solid var(--primary);
  display: none;
  margin: 20px auto;
}

.loader-container {
  text-align: center;
  padding: 60px 20px;
}

.loader {
  width: 80px;
  height: 80px;
  border: 5px solid rgba(255, 255, 255, 0.1);
  border-top: 5px solid var(--primary);
  border-radius: 50%;
  margin: 0 auto 30px;
  animation: spin 1.5s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loader-text {
  font-size: 1.5rem;
  color: var(--primary);
  letter-spacing: 2px;
}

.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
}

.toast {
  background: var(--glass);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  border-left: 4px solid var(--primary);
  border-radius: 10px;
  padding: 15px 20px;
  margin-bottom: 10px;
  color: white;
  font-weight: 500;
  box-shadow: var(--shadow);
  animation: slideIn 0.3s ease;
  min-width: 300px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.toast-success {
  border-left-color: #25D366;
}

.toast-error {
  border-left-color: var(--accent);
}

.toast-warning {
  border-left-color: #ffaa00;
}

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(5, 5, 16, 0.9);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s, visibility 0.3s;
  padding: 20px;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal {
  background: var(--glass);
  border-radius: 20px;
  padding: 40px;
  max-width: 500px;
  width: 100%;
  border: 1px solid var(--glass-border);
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
  transform: translateY(30px);
  transition: transform 0.4s;
  text-align: center;
}

.modal-overlay.active .modal {
  transform: translateY(0);
}

.modal-icon {
  font-size: 3rem;
  color: var(--primary);
  margin-bottom: 20px;
}

.modal-title {
  font-size: 1.8rem;
  margin-bottom: 15px;
  color: var(--primary);
}

.modal-message {
  margin-bottom: 30px;
  line-height: 1.6;
  color: var(--gray);
}

.verification-code {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid var(--primary);
  border-radius: 10px;
  padding: 20px;
  font-size: 2rem;
  font-weight: 700;
  letter-spacing: 3px;
  color: var(--primary);
  margin: 25px 0;
  font-family: monospace;
  cursor: pointer;
  transition: var(--transition);
}

.verification-code:hover {
  background: rgba(0, 255, 204, 0.1);
  box-shadow: var(--neon-glow);
}

.copy-notice {
  color: var(--gray);
  font-size: 0.9rem;
  margin-top: 10px;
}

.modal-btn {
  background: linear-gradient(135deg, var(--secondary), #5a1cb3);
  color: white;
  border: none;
  padding: 15px 30px;
  border-radius: 10px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  margin-top: 20px;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.modal-btn:hover {
  background: linear-gradient(135deg, #5a1cb3, var(--secondary));
  box-shadow: 0 0 15px var(--secondary);
}

.hidden {
  display: none !important;
}

.progress-steps {
  display: flex;
  justify-content: center;
  margin-bottom: 40px;
  gap: 20px;
}

.step {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

.step-circle {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--gray);
  font-weight: 600;
  transition: var(--transition);
}

.step.active .step-circle {
  background: var(--primary);
  color: var(--dark);
  box-shadow: var(--neon-glow);
}

.step.completed .step-circle {
  background: #25D366;
  color: white;
}

.step-label {
  font-size: 0.9rem;
  color: var(--gray);
}

.step.active .step-label {
  color: var(--primary);
  font-weight: 600;
}

/* Flagged member alert modal */
.flagged-modal .modal {
  max-width: 450px;
}

.flagged-modal .modal-icon {
  color: var(--accent);
}

.flagged-modal .modal-title {
  color: var(--accent);
}

.contact-superior-btn {
  background: linear-gradient(135deg, var(--accent), #cc3d3d);
  color: white;
  border: none;
  padding: 15px 30px;
  border-radius: 10px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  margin-top: 15px;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.contact-superior-btn:hover {
  background: linear-gradient(135deg, #cc3d3d, var(--accent));
  box-shadow: 0 0 15px var(--accent);
}

@media (max-width: 768px) {
  .container {
    padding: 15px;
  }
  
  .header h1 {
    font-size: 3rem;
  }
  
  .section {
    padding: 30px 20px;
  }
  
  .buttons-container {
    flex-direction: column;
    align-items: center;
  }
  
  .btn {
    width: 100%;
    max-width: 300px;
  }
  
  .progress-steps {
    flex-wrap: wrap;
    gap: 15px;
  }
}





</style>
</head>

<body>
<div class="toast-container" id="toastContainer"></div>

<!-- Verification Code Modal -->
<div class="modal-overlay" id="codeModal">
  <div class="modal">
    <div class="modal-icon">
      <i class="fas fa-key"></i>
    </div>
    <h3 class="modal-title">Your Verification Code</h3>
    <p class="modal-message">Copy this unique code and share it in the WhatsApp group to complete your verification.</p>
    
    <div class="verification-code" id="verificationCode">TRP-XXXXXX</div>
    <p class="copy-notice">Click the code to copy it to clipboard</p>
    
    <button class="modal-btn" id="whatsappRedirectBtn">
      <i class="fab fa-whatsapp"></i> Open WhatsApp Group
    </button>
  </div>
</div>

<!-- Flagged Member Modal -->
<div class="modal-overlay flagged-modal" id="flaggedModal">
  <div class="modal">
    <div class="modal-icon">
      <i class="fas fa-ban"></i>
    </div>
    <h3 class="modal-title">Access Denied</h3>
    <p class="modal-message">
      Your phone number has been flagged in our system.<br><br>
      <strong>Reason:</strong> <span id="flagReason">Suspicious activity</span><br><br>
      Please contact your superior to resolve this issue before proceeding with membership registration.
    </p>
    
    <button class="contact-superior-btn" onclick="closeFlaggedModal()">
      <i class="fas fa-user-shield"></i> Contact Superior
    </button>
    <button class="modal-btn" onclick="closeFlaggedModal()" style="margin-top: 10px; background: rgba(255,255,255,0.1);">
      <i class="fas fa-arrow-left"></i> Return to Step 1
    </button>
  </div>
</div>

<div class="container">
  <div class="header">
    <h1>TRUPPERS</h1>
    <p class="subtitle">Join the futuristic community of verified members</p>
  </div>

  <div class="progress-steps" id="progressSteps">
    <div class="step active" id="step1">
      <div class="step-circle">1</div>
      <div class="step-label">Guidelines</div>
    </div>
    <div class="step" id="step2">
      <div class="step-circle">2</div>
      <div class="step-label">Your Info</div>
    </div>
    <div class="step" id="step3">
      <div class="step-circle">3</div>
      <div class="step-label">Upload Photo</div>
    </div>
    <div class="step" id="step4">
      <div class="step-circle">4</div>
      <div class="step-label">Join Group</div>
    </div>
  </div>

  <section id="guide" class="section">
    <h2 class="guide-title"><i class="fas fa-compass"></i> Membership Guidelines</h2>
    
    <div class="guide-content">
      <p>Welcome to Truppers, the exclusive community for forward-thinkers and innovators. Before proceeding, please carefully read and understand our membership guidelines.</p>
      
      <ul class="guide-list">
        <li><strong>Real Identity Required:</strong> You must use your actual legal name and identity.</li>
        <li><strong>Authentic Photo Upload:</strong> A clear, recent photograph of yourself must be uploaded for verification purposes.</li>
        <li><strong>Membership Policy:</strong> All joining members must be mentally sound, mature in wisdom and judgment, and must have no history of foolish or irresponsible behavior. He or she must clearly understand the difference between good and bad actions, be serious and disciplined, and serve as a role model to be followed in decision-making and national development.</li>
        <li><strong>Mandatory Verification:</strong> All information provided will undergo a verification process.</li>
        <li><strong>Follow your commander’s orders to build yourself and strengthen your mentality.</strong> </li>
      </ul>
      
      <p>By proceeding, you acknowledge that you have read, understood, and agree to abide by these guidelines.</p>
    </div>
    
    <div class="buttons-container">
      <button class="btn btn-agree" id="agreeBtn">
        <i class="fas fa-check-circle"></i> I Agree & Continue
      </button>
      <button class="btn btn-cancel" id="cancelBtn">
        <i class="fas fa-times-circle"></i> Cancel
      </button>
    </div>
  </section>

  <section id="form" class="section hidden">
    <h2 class="guide-title"><i class="fas fa-user-edit"></i> Your Information</h2>
    
    <div class="form-group">
      <label class="input-label">Full Legal Name</label>
      <input id="name" class="input-field" placeholder="Enter your full name">
      <div class="input-highlight"></div>
    </div>
    
    <div class="form-group">
      <label class="input-label">Phone Number</label>
      <input id="phone" class="input-field" placeholder="Enter your phone number with country code">
      <div class="input-highlight"></div>
    </div>
    
    <button class="btn btn-submit" id="submitBtn">
      <i class="fas fa-paper-plane"></i> Submit & Continue
    </button>
  </section>

  <section id="loader" class="section hidden">
    <div class="loader-container">
      <div class="loader"></div>
      <p class="loader-text" id="loaderText">Processing</p>
      <p id="loaderSubtext">Please wait...</p>
    </div>
  </section>

  <section id="upload" class="section hidden">
    <h2 class="guide-title"><i class="fas fa-camera"></i> Upload Your Photo</h2>
    
    <img id="imagePreview" class="image-preview" alt="Preview">
    
    <div class="file-upload" id="fileUploadArea">
      <i class="fas fa-cloud-upload-alt"></i>
      <p>Click to select or drag & drop your photo</p>
      <p class="file-name" id="fileName">No file selected</p>
      <input type="file" id="photo" class="file-input" accept="image/*">
    </div>
    
    <button class="btn btn-upload" id="uploadBtn">
      <i class="fas fa-upload"></i> Upload & Continue
    </button>
  </section>

  <section id="whatsapp" class="section hidden">
    <h2 class="guide-title"><i class="fab fa-whatsapp"></i> Final Step</h2>
    <p>Click the button below to get your verification code and join our WhatsApp group.</p>
    
    <div style="text-align: center; margin: 30px 0;">
      <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--primary); margin-bottom: 20px;"></i>
      <p id="verificationMessage">Your profile is ready!</p>
    </div>
    
    <button class="btn btn-whatsapp" id="whatsappBtn">
      <i class="fab fa-whatsapp"></i> GET VERIFICATION CODE
    </button>

    <div style="margin-top: 20px; text-align: center;">
        <button class="btn btn-cancel" id="alreadyJoinedBtn" onclick="resetRegistration()">
            <i class="fas fa-redo"></i> Already in WhatsApp Group
        </button>
    </div>
  </section>
</div>

<script>
// ============================================
// INITIALIZATION - RUNS ONCE
// ============================================
(function() {
    'use strict';
    
    // Clear any existing supabase to avoid conflicts
    if (window.supabase && typeof window.supabase === 'object') {
        console.log('Supabase already loaded from CDN');
    }
})();

// ============================================
// CONFIGURATION - UPDATED WITH YOUR LINK
// ============================================
const CONFIG = {
    SUPABASE_URL: "https://ybnvozrsmtjkxoyoyihi.supabase.co",
    SUPABASE_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlibnZvenJzbXRqa3hveW95aWhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxNTQ5ODAsImV4cCI6MjA4MzczMDk4MH0.ErY9Hhzua5lRUC-M_Zi5zm1XtIU0LzGA5Xa1Com8jC4",
    
    // UPDATE THIS LINE WITH YOUR ACTUAL WHATSAPP LINK
    WHATSAPP_GROUP_LINK: "https://chat.whatsapp.com/DQZ8KksecUPKLDParih34U",
    
    MAX_FILE_SIZE: 5 * 1024 * 1024, // 5MB
    ALLOWED_FILE_TYPES: ['image/jpeg', 'image/png', 'image/webp'],
    STORAGE_BUCKET: "member-images"
};

// ============================================
// GLOBALS - INITIALIZE ONCE
// ============================================
let supabaseClient = null;
let currentMember = {
    id: null,
    code: null,
    name: null,
    phone: null,
    step: 1,
    photoUploaded: false,
    formSubmitted: false,
    isExistingMember: false,
    isFlagged: false,
    flagReason: null
};

// ============================================
// INITIALIZE SUPABASE - SINGLE TIME
// ============================================
function initSupabase() {
    if (window.supabase && !supabaseClient) {
        supabaseClient = window.supabase.createClient(
            CONFIG.SUPABASE_URL,
            CONFIG.SUPABASE_KEY
        );
        console.log('Supabase initialized');
    }
    return supabaseClient;
}

// ============================================
// ENHANCED STORAGE MANAGEMENT WITH AUTO-RESUME
// ============================================
const Storage = {
    // Save ALL progress data
    save() {
        const progressData = {
            id: currentMember.id,
            code: currentMember.code,
            name: currentMember.name,
            phone: currentMember.phone,
            step: currentMember.step,
            photoUploaded: currentMember.photoUploaded,
            formSubmitted: currentMember.formSubmitted,
            isExistingMember: currentMember.isExistingMember,
            isFlagged: currentMember.isFlagged,
            flagReason: currentMember.flagReason,
            timestamp: new Date().getTime()
        };
        
        localStorage.setItem('truppers_progress', JSON.stringify(progressData));
        console.log('Progress saved to localStorage:', progressData.step);
    },
    
    // Load saved progress
    load() {
        try {
            const saved = localStorage.getItem('truppers_progress');
            if (!saved) return false;
            
            const data = JSON.parse(saved);
            
            // Check if data is older than 24 hours (optional)
            const now = new Date().getTime();
            const hoursOld = (now - (data.timestamp || 0)) / (1000 * 60 * 60);
            
            if (hoursOld > 24) {
                console.log('Progress expired (older than 24 hours)');
                this.clear();
                return false;
            }
            
            // Restore all data
            currentMember.id = data.id || null;
            currentMember.code = data.code || null;
            currentMember.name = data.name || null;
            currentMember.phone = data.phone || null;
            currentMember.step = data.step || 1;
            currentMember.photoUploaded = data.photoUploaded || false;
            currentMember.formSubmitted = data.formSubmitted || false;
            currentMember.isExistingMember = data.isExistingMember || false;
            currentMember.isFlagged = data.isFlagged || false;
            currentMember.flagReason = data.flagReason || null;
            
            console.log('Progress loaded from localStorage. Step:', currentMember.step);
            console.log('Is existing member:', currentMember.isExistingMember);
            console.log('Is flagged:', currentMember.isFlagged);
            
            return true;
            
        } catch (error) {
            console.error('Error loading progress:', error);
            return false;
        }
    },
    
    // Clear all progress
    clear() {
        currentMember = {
            id: null,
            code: null,
            name: null,
            phone: null,
            step: 1,
            photoUploaded: false,
            formSubmitted: false,
            isExistingMember: false,
            isFlagged: false,
            flagReason: null
        };
        localStorage.removeItem('truppers_progress');
        console.log('Progress cleared from localStorage');
    },
    
    // Save step specifically
    saveStep(step) {
        currentMember.step = step;
        this.save();
    }
};

// ============================================
// MEMBER CHECKING FUNCTIONS
// ============================================
const MemberCheck = {
    // Check if member exists and is flagged
    async checkExistingMember(phone) {
        console.log('Checking existing member for phone:', phone);
        
        try {
            const client = initSupabase();
            if (!client) {
                console.log('Supabase not available, skipping member check');
                return { exists: false, flagged: false, reason: null };
            }
            
            Utils.showLoading(true, 'Checking database...', 'Verifying member status');
            
            // Query for existing member with this phone
            const { data, error } = await client
                .from('members')
                .select('*')
                .eq('phone_number', phone)
                .maybeSingle();
            
            Utils.showLoading(false);
            
            if (error) {
                console.error('Error checking member:', error);
                return { exists: false, flagged: false, reason: null };
            }
            
            if (!data) {
                console.log('No existing member found');
                return { exists: false, flagged: false, reason: null };
            }
            
            console.log('Existing member found:', data);
            
            return {
                exists: true,
                flagged: data.is_flagged || false,
                reason: data.flag_case || null,
                memberData: data
            };
            
        } catch (error) {
            console.error('Error in member check:', error);
            Utils.showLoading(false);
            return { exists: false, flagged: false, reason: null };
        }
    },
    
    // Handle flagged member
    handleFlaggedMember(reason) {
        console.log('Handling flagged member with reason:', reason);
        
        currentMember.isFlagged = true;
        currentMember.flagReason = reason;
        Storage.save();
        
        // Show flagged modal
        document.getElementById('flagReason').textContent = reason || 'Suspicious activity detected';
        document.getElementById('flaggedModal').classList.add('active');
        
        // Reset to step 1
        setTimeout(() => {
            Flow.goToStep(1, false);
        }, 500);
    },
    
    // Handle existing non-flagged member
    handleExistingMember(memberData) {
        console.log('Handling existing non-flagged member:', memberData);
        
        currentMember.isExistingMember = true;
        currentMember.id = memberData.id;
        currentMember.code = memberData.verification_code;
        currentMember.name = memberData.full_name;
        currentMember.phone = memberData.phone_number;
        currentMember.photoUploaded = !!memberData.image_url;
        currentMember.formSubmitted = true;
        
        Storage.save();
        
        // Skip to step 4 (WhatsApp)
        Flow.goToStep(4);
        Utils.showToast('Welcome back! You can join the WhatsApp group directly.', 'success');
        
        // Update verification message
        UI.updateVerificationMessage();
    }
};

// ============================================
// UTILITY FUNCTIONS
// ============================================
const Utils = {
    showToast(message, type = 'info') {
        const container = document.getElementById('toastContainer');
        if (!container) return;
        
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
            <i class="fas ${this.getToastIcon(type)}"></i>
            <span>${message}</span>
        `;
        
        container.appendChild(toast);
        
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => toast.remove(), 300);
        }, 4000);
    },
    
    getToastIcon(type) {
        const icons = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            warning: 'fa-exclamation-triangle',
            info: 'fa-info-circle'
        };
        return icons[type] || icons.info;
    },
    
    showLoading(show, text = 'Processing...', subtext = '') {
        const loader = document.getElementById('loader');
        const loaderText = document.getElementById('loaderText');
        const loaderSubtext = document.getElementById('loaderSubtext');
        
        if (loader) {
            loader.classList.toggle('hidden', !show);
            if (loaderText) loaderText.textContent = text;
            if (loaderSubtext) loaderSubtext.textContent = subtext;
        }
    },
    
    validateName(name) {
        return name && name.trim().length >= 2;
    },
    
    validatePhone(phone) {
        const cleaned = phone.replace(/[^\d+]/g, '');
        return cleaned.length >= 10;
    },
    
    generateCode() {
        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
        let code = 'TRP-';
        for (let i = 0; i < 6; i++) {
            code += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return code;
    },
    
    copyToClipboard(text) {
        return navigator.clipboard.writeText(text);
    },
    
    async compressImage(file) {
        return new Promise((resolve, reject) => {
            if (!CONFIG.ALLOWED_FILE_TYPES.includes(file.type)) {
                reject(new Error('Please upload JPEG, PNG, or WebP image'));
                return;
            }
            
            if (file.size > CONFIG.MAX_FILE_SIZE) {
                reject(new Error('File size must be less than 5MB'));
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    const maxWidth = 800;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    ctx.drawImage(img, 0, 0, width, height);
                    canvas.toBlob(
                        (blob) => {
                            resolve(new File([blob], `truppers_${Date.now()}.jpg`, { 
                                type: 'image/jpeg' 
                            }));
                        },
                        'image/jpeg',
                        0.8
                    );
                };
                img.onerror = reject;
                img.src = e.target.result;
            };
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    },
    
    // Restore form fields
    restoreFormFields() {
        if (currentMember.name) {
            const nameInput = document.getElementById('name');
            if (nameInput) nameInput.value = currentMember.name;
        }
        if (currentMember.phone) {
            const phoneInput = document.getElementById('phone');
            if (phoneInput) phoneInput.value = currentMember.phone;
        }
    },
    
    // Show welcome back message
    showWelcomeBack() {
        if (currentMember.step > 1) {
            setTimeout(() => {
                this.showToast(`Welcome back! Resuming from step ${currentMember.step}`, 'info');
            }, 1000);
        }
    }
};

// ============================================
// UI FUNCTIONS
// ============================================
const UI = {
    updateSteps(step) {
        document.querySelectorAll('.step').forEach((s, index) => {
            s.classList.remove('active', 'completed');
            if (index + 1 === step) {
                s.classList.add('active');
            } else if (index + 1 < step) {
                s.classList.add('completed');
            }
        });
    },
    
    showSection(sectionId) {
        ['guide', 'form', 'loader', 'upload', 'whatsapp'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.classList.add('hidden');
        });
        
        const target = document.getElementById(sectionId);
        if (target) {
            target.classList.remove('hidden');
            // Smooth scroll to top of section
            setTimeout(() => {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }
    },
    
    updateFilePreview(file) {
        const preview = document.getElementById('imagePreview');
        const fileName = document.getElementById('fileName');
        
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
            fileName.textContent = `${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
        } else {
            preview.style.display = 'none';
            fileName.textContent = 'No file selected';
        }
    },
    
    showVerificationModal() {
        const modal = document.getElementById('codeModal');
        const codeEl = document.getElementById('verificationCode');
        
        codeEl.textContent = currentMember.code || Utils.generateCode();
        modal.classList.add('active');
        
        // Make code copyable
        codeEl.onclick = () => {
            Utils.copyToClipboard(codeEl.textContent).then(() => {
                const original = codeEl.textContent;
                codeEl.textContent = 'Copied!';
                codeEl.style.color = '#00ffcc';
                setTimeout(() => {
                    codeEl.textContent = original;
                    codeEl.style.color = '';
                }, 2000);
            });
        };
    },
    
    hideVerificationModal() {
        document.getElementById('codeModal').classList.remove('active');
    },
    
    closeFlaggedModal() {
        document.getElementById('flaggedModal').classList.remove('active');
        // Clear flagged status when modal is closed
        currentMember.isFlagged = false;
        currentMember.flagReason = null;
        Storage.save();
    },
    
    // Update verification message on WhatsApp section
    updateVerificationMessage() {
        const msgEl = document.getElementById('verificationMessage');
        if (msgEl && currentMember.code) {
            if (currentMember.isExistingMember) {
                msgEl.innerHTML = `Welcome back ${currentMember.name}!<br>
                    <small style="color: var(--primary); font-weight: 600;">
                        Your existing verification code: ${currentMember.code}
                    </small><br>
                    <small style="color: var(--gray); font-size: 0.9rem;">
                        Click the button below to join the WhatsApp group
                    </small>`;
            } else {
                msgEl.innerHTML = `Welcome ${currentMember.name}!<br>
                    <small style="color: var(--primary); font-weight: 600;">
                        Your verification code: ${currentMember.code}
                    </small><br>
                    <small style="color: var(--gray); font-size: 0.9rem;">
                        Click the button below to get your code and join the group
                    </small>`;
            }
        }
    }
};

// ============================================
// APPLICATION FLOW WITH AUTO-RESUME AND MEMBER CHECK
// ============================================
const Flow = {
    goToStep(step, saveProgress = true) {
        console.log('Going to step:', step, 'Save progress:', saveProgress);
        
        currentMember.step = step;
        
        if (saveProgress) {
            Storage.save();
        }
        
        UI.updateSteps(step);
        
        switch(step) {
            case 1:
                UI.showSection('guide');
                break;
            case 2:
                UI.showSection('form');
                Utils.restoreFormFields();
                break;
            case 3:
                UI.showSection('upload');
                // If photo was previously uploaded, show message
                if (currentMember.photoUploaded) {
                    document.getElementById('fileName').textContent = 'Photo already uploaded ✓';
                    Utils.showToast('Photo already uploaded. You can upload a new one if needed.', 'info');
                }
                break;
            case 4:
                UI.showSection('whatsapp');
                UI.updateVerificationMessage();
                break;
        }
    },
    
    // CLICKABLE BUTTON: Agree
    onAgreeClick() {
        console.log('Agree button clicked!');
        Flow.goToStep(2);
    },
    
    // CLICKABLE BUTTON: Cancel
    onCancelClick() {
        if (confirm('Are you sure you want to cancel? This will clear all your progress.')) {
            Storage.clear();
            document.getElementById('name').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('fileName').textContent = 'No file selected';
            document.getElementById('imagePreview').style.display = 'none';
            Flow.goToStep(1, false);
            Utils.showToast('Registration cancelled. All progress cleared.', 'info');
        }
    },
    
    // CLICKABLE BUTTON: Submit Form (WITH MEMBER CHECK)
    async onSubmitClick() {
        const name = document.getElementById('name').value.trim();
        const phone = document.getElementById('phone').value.trim();
        
        if (!Utils.validateName(name)) {
            Utils.showToast('Please enter your full name (min 2 characters)', 'error');
            return;
        }
        
        if (!Utils.validatePhone(phone)) {
            Utils.showToast('Please enter a valid phone number', 'error');
            return;
        }
        
        // Save locally
        currentMember.name = name;
        currentMember.phone = phone;
        currentMember.formSubmitted = true;
        
        // CHECK IF MEMBER EXISTS IN DATABASE
        const memberCheck = await MemberCheck.checkExistingMember(phone);
        
        if (memberCheck.exists) {
            if (memberCheck.flagged) {
                // Member is flagged - show blocked message
                MemberCheck.handleFlaggedMember(memberCheck.reason);
                return;
            } else {
                // Member exists and is not flagged - skip to WhatsApp
                MemberCheck.handleExistingMember(memberCheck.memberData);
                return;
            }
        }
        
        // New member - generate code and continue normally
        if (!currentMember.code) {
            currentMember.code = Utils.generateCode();
        }
        
        currentMember.isExistingMember = false;
        Storage.save();
        
        // Try to save to Supabase if available
        const client = initSupabase();
        if (client) {
            try {
                Utils.showLoading(true, 'Creating your account...', 'Saving to database');
                
                const { data, error } = await client
                    .from('members')
                    .insert({
                        full_name: name,
                        phone_number: phone,
                        verification_code: currentMember.code,
                        created_at: new Date().toISOString(),
                        is_verified: false,
                        is_flagged: false
                    })
                    .select()
                    .single();
                
                Utils.showLoading(false);
                
                if (error) {
                    console.error('Supabase insert error:', error);
                    // Continue with local storage
                    Utils.showToast('Saved locally (database error)', 'warning');
                    Flow.goToStep(3);
                    return;
                }
                
                currentMember.id = data.id;
                Storage.save();
                
                Utils.showToast('Account created successfully!', 'success');
                Flow.goToStep(3);
                
            } catch (error) {
                Utils.showLoading(false);
                console.error('Supabase error:', error);
                // Continue with local storage
                Utils.showToast('Saved locally (offline mode)', 'warning');
                Flow.goToStep(3);
            }
        } else {
            // Supabase not available, continue locally
            Utils.showToast('Saved locally', 'info');
            Flow.goToStep(3);
        }
    },
    
    // CLICKABLE BUTTON: Upload Photo
    async onUploadClick() {
        const fileInput = document.getElementById('photo');
        const file = fileInput.files[0];
        
        // Allow skipping photo upload if already uploaded
        if (!file && !currentMember.photoUploaded) {
            Utils.showToast('Please select a photo to upload', 'error');
            return;
        }
        
        if (!currentMember.id && !currentMember.formSubmitted) {
            Utils.showToast('Please complete the previous steps', 'error');
            return;
        }
        
        try {
            if (file) {
                Utils.showLoading(true, 'Processing image...', 'Compressing photo');
                
                // Compress image
                const compressedFile = await Utils.compressImage(file);
                UI.updateFilePreview(compressedFile);
                
                // Try to upload to Supabase if available
                const client = initSupabase();
                if (client && currentMember.id) {
                    const fileName = `${currentMember.id}_${Date.now()}.jpg`;
                    console.log('Uploading file:', fileName);
                    
                    Utils.showLoading(true, 'Uploading to cloud...', 'Please wait');
                    
                    // Upload to storage
                    const { data: uploadData, error: uploadError } = await client.storage
                        .from(CONFIG.STORAGE_BUCKET)
                        .upload(fileName, compressedFile, {
                            cacheControl: '3600',
                            contentType: 'image/jpeg',
                            upsert: false
                        });
                    
                    if (uploadError) {
                        console.error('Storage upload error:', uploadError);
                        // Continue without photo
                        Utils.showLoading(true, 'Updating profile...', 'Skipping photo upload');
                    } else {
                        // Get public URL
                        const { data: { publicUrl } } = client.storage
                            .from(CONFIG.STORAGE_BUCKET)
                            .getPublicUrl(fileName);
                        
                        // Update member record with image URL
                        const { error: updateError } = await client
                            .from('members')
                            .update({
                                image_url: publicUrl,
                                is_verified: true,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', currentMember.id);
                        
                        if (updateError) {
                            console.error('Database update error:', updateError);
                        }
                    }
                }
                
                currentMember.photoUploaded = true;
                Storage.save();
                
                Utils.showLoading(false);
                Utils.showToast('Photo uploaded successfully!', 'success');
            } else {
                // Photo already uploaded previously
                Utils.showToast('Using previously uploaded photo', 'info');
            }
            
            Flow.goToStep(4);
            
        } catch (error) {
            Utils.showLoading(false);
            console.error('Upload error:', error);
            
            // Still continue to next step
            Utils.showToast('Photo upload skipped. You can still get verification.', 'warning');
            Flow.goToStep(4);
        }
    },
    
    // CLICKABLE BUTTON: WhatsApp (shows code)
    onWhatsAppClick() {
        UI.showVerificationModal();
    },
    
    // CLICKABLE BUTTON: Open WhatsApp after seeing code
    onOpenWhatsAppClick() {
        UI.hideVerificationModal();
        
        const verificationCode = currentMember.code;
        const message = encodeURIComponent(
            `TRUPPERS VERIFICATION\n\n` +
            `Verification Code: ${verificationCode}\n` +
            `Name: ${currentMember.name}\n` +
            `Phone: ${currentMember.phone}\n\n` +
            `${currentMember.isExistingMember ? 'Returning member' : 'New member verification'}.`
        );
        
        const whatsappLink = `${CONFIG.WHATSAPP_GROUP_LINK}?text=${message}`;
        
        if (!whatsappLink.includes('whatsapp.com')) {
            Utils.showToast('Invalid WhatsApp link configuration', 'error');
            return;
        }
        
        console.log('Opening WhatsApp with code:', verificationCode);
        window.open(whatsappLink, '_blank');
        
        // Mark as completed
        setTimeout(() => {
            Utils.showToast('Registration completed! You can now close this page.', 'success');
            // Optional: Clear progress after successful completion
            setTimeout(() => Storage.clear(), 5000);
        }, 1000);
    }
};

// ============================================
// SETUP EVENT LISTENERS
// ============================================
function setupEventListeners() {
    console.log('Setting up event listeners...');
    
    // AGREE BUTTON
    const agreeBtn = document.getElementById('agreeBtn');
    if (agreeBtn) agreeBtn.addEventListener('click', Flow.onAgreeClick);
    
    // CANCEL BUTTON
    const cancelBtn = document.getElementById('cancelBtn');
    if (cancelBtn) cancelBtn.addEventListener('click', Flow.onCancelClick);
    
    // SUBMIT BUTTON
    const submitBtn = document.getElementById('submitBtn');
    if (submitBtn) submitBtn.addEventListener('click', Flow.onSubmitClick);
    
    // ENTER KEY IN FORM
    document.getElementById('name')?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') Flow.onSubmitClick();
    });
    
    document.getElementById('phone')?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') Flow.onSubmitClick();
    });
    
    // UPLOAD BUTTON
    const uploadBtn = document.getElementById('uploadBtn');
    if (uploadBtn) uploadBtn.addEventListener('click', Flow.onUploadClick);
    
    // WHATSAPP BUTTON
    const whatsappBtn = document.getElementById('whatsappBtn');
    if (whatsappBtn) whatsappBtn.addEventListener('click', Flow.onWhatsAppClick);
    
    // MODAL WHATSAPP BUTTON
    const modalWhatsappBtn = document.getElementById('whatsappRedirectBtn');
    if (modalWhatsappBtn) modalWhatsappBtn.addEventListener('click', Flow.onOpenWhatsAppClick);
    
    // FILE UPLOAD HANDLING
    const fileUploadArea = document.getElementById('fileUploadArea');
    const fileInput = document.getElementById('photo');
    
    if (fileUploadArea && fileInput) {
        fileUploadArea.addEventListener('click', () => fileInput.click());
        
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.style.borderColor = 'var(--primary)';
            fileUploadArea.style.background = 'rgba(0, 255, 204, 0.05)';
        });
        
        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.style.borderColor = '';
            fileUploadArea.style.background = '';
        });
        
        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.style.borderColor = '';
            fileUploadArea.style.background = '';
            if (e.dataTransfer.files[0]) {
                fileInput.files = e.dataTransfer.files;
                UI.updateFilePreview(e.dataTransfer.files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) UI.updateFilePreview(e.target.files[0]);
        });
    }
    
    // MODAL CLOSE (click outside)
    document.getElementById('codeModal')?.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay')) {
            UI.hideVerificationModal();
        }
    });
    
    // Flagged modal close
    document.getElementById('flaggedModal')?.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay')) {
            UI.closeFlaggedModal();
        }
    });
    
    // AUTO-SAVE WHEN USER TYPES
    document.getElementById('name')?.addEventListener('input', () => {
        Storage.save();
    });
    
    document.getElementById('phone')?.addEventListener('input', () => {
        Storage.save();
    });
    
    console.log('All event listeners setup complete');
}

// ============================================
// INITIALIZE APPLICATION WITH AUTO-RESUME
// ============================================
async function initApp() {
    console.log('Initializing Truppers application...');
    
    // Initialize Supabase
    initSupabase();
    
    // Load saved progress FIRST
    const hasSavedProgress = Storage.load();
    
    // Check if user was flagged in previous session
    if (currentMember.isFlagged) {
        console.log('User was previously flagged');
        MemberCheck.handleFlaggedMember(currentMember.flagReason);
        return;
    }
    
    // Start at saved step (or step 1 if no saved progress)
    const startStep = hasSavedProgress ? currentMember.step : 1;
    
    console.log('Starting at step:', startStep, 'Has saved progress:', hasSavedProgress);
    
    // Go to the appropriate step
    Flow.goToStep(startStep, false);
    
    // Setup all event listeners
    setupEventListeners();
    
    // Show welcome message
    setTimeout(() => {
        if (hasSavedProgress) {
            Utils.showWelcomeBack();
        } else {
            Utils.showToast('Welcome to Truppers! Read the guidelines to begin.', 'info');
        }
    }, 1000);
    
    console.log('Application initialized at step:', startStep);
}

// ============================================
// START THE APPLICATION
// ============================================
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initApp);
} else {
    initApp();
}

// ============================================
// ERROR HANDLING
// ============================================
window.addEventListener('error', (e) => {
    console.error('Global error:', e.error);
    Utils.showToast('An error occurred. Please refresh if issues persist.', 'error');
});

window.addEventListener('unhandledrejection', (e) => {
    console.error('Unhandled promise:', e.reason);
    Utils.showToast('Network error. Please check connection.', 'error');
});

// ============================================
// DEBUG HELPERS
// ============================================
window.debugTruppers = {
    getCurrentMember: () => currentMember,
    getStorage: () => localStorage.getItem('truppers_progress'),
    clearProgress: () => Storage.clear(),
    forceStep: (step) => Flow.goToStep(step),
    simulateFlaggedMember: () => {
        currentMember.phone = '+1234567890';
        currentMember.isFlagged = true;
        currentMember.flagReason = 'Test flag reason';
        MemberCheck.handleFlaggedMember('Test flag reason');
    },
    simulateExistingMember: () => {
        currentMember.phone = '+1234567890';
        currentMember.isExistingMember = true;
        currentMember.code = 'TRP-TEST123';
        currentMember.name = 'Test User';
        Flow.goToStep(4);
    }
};

// Add UI.closeFlaggedModal to window
window.closeFlaggedModal = UI.closeFlaggedModal;

function resetRegistration() {
    if (confirm('Reset registration and return to Step 1?')) {
        // Clear localStorage
        localStorage.removeItem('truppers_progress');
        
        // Reset form
        document.getElementById('name').value = '';
        document.getElementById('phone').value = '';
        
        // Hide all sections, show Step 1
        document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
        document.getElementById('guide').classList.remove('hidden');
        
        // Reset steps
        document.querySelectorAll('.step').forEach((step, index) => {
            step.classList.remove('active', 'completed');
            if (index === 0) step.classList.add('active');
        });
        
        // Show message
        alert('Registration reset. You can start over if needed.');
    }
}
</script>
</body>
</html>
