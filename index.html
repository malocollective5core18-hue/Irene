<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudinary Image Broadcast - Live</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Cloudinary Upload Widget -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>

<style>

    /* style.css - Updated */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    padding: 20px;
    color: #333;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    background-color: white;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

header {
    background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
    color: white;
    padding: 25px;
    text-align: center;
}

header h1 {
    font-size: 2.3rem;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

.subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto 15px;
}

.cloudinary-status {
    background: rgba(255, 255, 255, 0.2);
    padding: 8px 15px;
    border-radius: 20px;
    display: inline-block;
    font-size: 0.9rem;
    margin-top: 10px;
}

.cloudinary-status i {
    margin-right: 8px;
}

main {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    padding: 30px;
}

@media (max-width: 900px) {
    main {
        grid-template-columns: 1fr;
    }
}

.upload-section, .broadcast-section {
    background-color: #f9fafc;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
}

h2 {
    color: #2c3e50;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.8rem;
}

.upload-options {
    margin-bottom: 25px;
}

.upload-options h3 {
    margin-bottom: 15px;
    color: #4b6cb7;
}

.options-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

@media (max-width: 600px) {
    .options-container {
        grid-template-columns: 1fr;
    }
}

.option-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    border: 2px solid #e1e8ff;
    transition: all 0.3s;
    cursor: pointer;
}

.option-card:hover {
    border-color: #4b6cb7;
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(75, 108, 183, 0.1);
}

.option-card i {
    color: #4b6cb7;
    margin-bottom: 15px;
}

.option-card h4 {
    margin-bottom: 10px;
    color: #2c3e50;
}

.option-card p {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 15px;
}

.option-btn {
    background: #4b6cb7;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s;
    width: 100%;
}

.option-btn:hover {
    background: #3a5ca9;
}

.upload-area {
    border: 3px dashed #4b6cb7;
    border-radius: 15px;
    height: 300px;
    position: relative;
    margin-bottom: 20px;
    cursor: pointer;
    transition: all 0.3s;
    background-color: white;
    overflow: hidden;
}

.upload-area:hover {
    background-color: #f0f5ff;
    border-color: #182848;
}

.upload-placeholder {
    text-align: center;
    color: #7a7a7a;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    padding: 20px;
}

.upload-placeholder i {
    color: #4b6cb7;
    margin-bottom: 15px;
}

.upload-note {
    font-size: 0.85rem;
    margin-top: 10px;
    color: #999;
}

.preview-container {
    width: 100%;
    height: 100%;
    position: relative;
}

#imagePreview {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background-color: #f5f7fa;
}

.preview-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.7);
    padding: 15px;
    display: flex;
    gap: 10px;
    justify-content: center;
}

.preview-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

#changeImageBtn {
    background: #f8f9fa;
    color: #333;
}

#uploadSelectedBtn {
    background: #2ecc71;
    color: white;
}

#uploadSelectedBtn:hover {
    background: #27ae60;
}

.upload-details {
    margin-top: 25px;
    padding-top: 20px;
    border-top: 1px solid #e1e1e1;
}

.status-box {
    background-color: white;
    border-radius: 10px;
    padding: 20px;
    border-left: 5px solid #4b6cb7;
}

.status-box p {
    margin-bottom: 10px;
}

.url-display {
    display: inline-block;
    word-break: break-all;
    background: #f5f7fa;
    padding: 8px 12px;
    border-radius: 6px;
    font-family: monospace;
    font-size: 0.9rem;
    margin-top: 5px;
    border: 1px solid #e1e1e1;
}

.progress-container {
    height: 10px;
    background-color: #e1e1e1;
    border-radius: 5px;
    margin: 15px 0;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
    width: 0%;
    transition: width 0.5s;
}

.progress-text {
    text-align: center;
    font-weight: bold;
    color: #4b6cb7;
}

.upload-actions {
    margin-top: 15px;
    display: flex;
    justify-content: center;
}

.action-btn {
    padding: 8px 20px;
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
}

.action-btn:hover {
    background: #c0392b;
}

.broadcast-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e1e8ff;
}

.broadcast-info {
    display: flex;
    align-items: center;
    gap: 15px;
}

.live-badge {
    background: #e74c3c;
    color: white;
    padding: 5px 12px;
    border-radius: 20px;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.9rem;
}

.live-badge i {
    font-size: 0.7rem;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.refresh-btn {
    background: #3498db;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
}

.refresh-btn:hover {
    background: #2980b9;
}

.image-container {
    background-color: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    margin-bottom: 25px;
}

.current-image {
    height: 350px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f5f7fa;
    position: relative;
}

.no-image {
    text-align: center;
    color: #aaa;
}

.no-image i {
    margin-bottom: 15px;
    color: #ddd;
}

.image-details {
    padding: 20px;
    border-top: 1px solid #e1e1e1;
}

.image-details h3 {
    margin-bottom: 15px;
    color: #2c3e50;
    display: flex;
    align-items: center;
    gap: 10px;
}

.image-details p {
    margin-bottom: 8px;
    display: flex;
    flex-wrap: wrap;
}

.image-details strong {
    min-width: 120px;
    display: inline-block;
}

.share-buttons {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-top: 20px;
}

.share-btn {
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-weight: 600;
    transition: all 0.3s;
}

#copyUrlBtn {
    background-color: #e1f0ff;
    color: #4b6cb7;
}

#copyUrlBtn:hover {
    background-color: #d0e4ff;
}

#openImageBtn {
    background-color: #4b6cb7;
    color: white;
}

#openImageBtn:hover {
    background-color: #3a5ca9;
}

#shareBroadcastBtn {
    background-color: #2ecc71;
    color: white;
}

#shareBroadcastBtn:hover {
    background-color: #27ae60;
}

.recent-uploads {
    margin-top: 30px;
}

.recent-images {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.recent-image-item {
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.3s;
}

.recent-image-item:hover {
    border-color: #4b6cb7;
    transform: translateY(-3px);
}

.recent-image-item img {
    width: 100%;
    height: 100px;
    object-fit: cover;
}

.instructions {
    background-color: #e1f0ff;
    border-radius: 10px;
    padding: 20px;
    border-left: 5px solid #4b6cb7;
    margin-top: 25px;
}

.instructions h3 {
    color: #2c3e50;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.instructions ol {
    padding-left: 20px;
    margin-bottom: 15px;
}

.instructions li {
    margin-bottom: 8px;
}

.demo-note {
    background-color: rgba(255, 255, 255, 0.7);
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
}

.demo-btn {
    background: #9b59b6;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 10px;
    font-weight: 600;
}

.demo-btn:hover {
    background: #8e44ad;
}

footer {
    background-color: #2c3e50;
    color: white;
    text-align: center;
    padding: 20px;
    margin-top: 30px;
}

footer code {
    background: rgba(255, 255, 255, 0.2);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: monospace;
}

.footer-note {
    font-size: 0.9rem;
    opacity: 0.7;
    margin-top: 5px;
}

.notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 15px 25px;
    background-color: #4b6cb7;
    color: white;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    transform: translateY(100px);
    opacity: 0;
    transition: transform 0.5s, opacity 0.5s;
    z-index: 1000;
    max-width: 400px;
}

.notification.show {
    transform: translateY(0);
    opacity: 1;
}

.notification.success {
    background-color: #2ecc71;
}

.notification.error {
    background-color: #e74c3c;
}

.notification.warning {
    background-color: #f39c12;
}
</style>

</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-images"></i> Live Image Broadcast</h1>
            <p class="subtitle">Upload an image and it will appear instantly for everyone!</p>
            <p class="cloudinary-status"><i class="fas fa-cloud"></i> Connected to Cloudinary: <strong>dcpqnmdas</strong></p>
        </header>

        <main>
            <div class="upload-section">
                <h2><i class="fas fa-cloud-upload-alt"></i> Upload Your Image</h2>
                
                <!-- Simple file input as alternative -->
                <div class="upload-options">
                    <h3>Choose upload method:</h3>
                    <div class="options-container">
                        <div class="option-card" id="cloudinaryWidgetOption">
                            <i class="fas fa-cloud fa-3x"></i>
                            <h4>Cloudinary Widget</h4>
                            <p>Advanced upload with progress</p>
                            <button class="option-btn" id="widgetUploadBtn">
                                <i class="fas fa-upload"></i> Use Widget
                            </button>
                        </div>
                        <div class="option-card" id="simpleUploadOption">
                            <i class="fas fa-file-upload fa-3x"></i>
                            <h4>Simple Upload</h4>
                            <p>Direct file selection</p>
                            <input type="file" id="fileInput" accept="image/*" style="display: none;">
                            <button class="option-btn" id="simpleUploadBtn">
                                <i class="fas fa-folder-open"></i> Choose File
                            </button>
                        </div>
                    </div>
                </div>

                <div class="upload-area" id="uploadWidgetArea">
                    <div class="upload-placeholder" id="uploadPlaceholder">
                        <i class="fas fa-cloud-upload-alt fa-3x"></i>
                        <p>Drag & drop image here or click to browse</p>
                        <p class="upload-note">Max file size: 10MB • Supported: JPG, PNG, GIF, WebP</p>
                    </div>
                    <div class="preview-container" id="previewContainer" style="display: none;">
                        <img id="imagePreview" src="" alt="Preview">
                        <div class="preview-overlay">
                            <button class="preview-btn" id="changeImageBtn"><i class="fas fa-exchange-alt"></i> Change</button>
                            <button class="preview-btn upload-btn" id="uploadSelectedBtn"><i class="fas fa-cloud-upload-alt"></i> Upload to Cloudinary</button>
                        </div>
                    </div>
                </div>

                <div class="upload-details" id="uploadDetails" style="display: none;">
                    <h3><i class="fas fa-spinner fa-spin"></i> Upload Status</h3>
                    <div class="status-box">
                        <p><strong>Status:</strong> <span id="uploadStatus">Preparing upload...</span></p>
                        <p><strong>Image URL:</strong> <br><span id="imageUrl" class="url-display">-</span></p>
                        <div class="progress-container">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                        <p class="progress-text" id="progressText">0%</p>
                        <div class="upload-actions">
                            <button class="action-btn" id="cancelUploadBtn" style="display: none;">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="broadcast-section">
                <h2><i class="fas fa-satellite-dish"></i> Live Broadcast</h2>
                <div class="broadcast-header">
                    <div class="broadcast-info">
                        <span class="live-badge"><i class="fas fa-circle"></i> LIVE</span>
                        <span>Images update every 5 seconds</span>
                    </div>
                    <button class="refresh-btn" id="refreshBroadcastBtn">
                        <i class="fas fa-sync-alt"></i> Refresh Now
                    </button>
                </div>
                
                <div class="image-container">
                    <div class="current-image" id="currentImage">
                        <div class="no-image">
                            <i class="fas fa-image fa-4x"></i>
                            <p>No image broadcast yet</p>
                            <p>Be the first to upload an image!</p>
                        </div>
                    </div>
                    
                    <div class="image-details" id="imageDetails" style="display: none;">
                        <h3><i class="fas fa-info-circle"></i> Broadcast Details</h3>
                        <p><strong>Uploaded:</strong> <span id="uploadTime">Just now</span></p>
                        <p><strong>Dimensions:</strong> <span id="imageDimensions">-</span></p>
                        <p><strong>Size:</strong> <span id="imageSize">-</span></p>
                        <p><strong>Cloudinary ID:</strong> <span id="imagePublicId">-</span></p>
                        <div class="share-buttons">
                            <button class="share-btn" id="copyUrlBtn">
                                <i class="fas fa-link"></i> Copy URL
                            </button>
                            <button class="share-btn" id="openImageBtn">
                                <i class="fas fa-external-link-alt"></i> Open Full
                            </button>
                            <button class="share-btn" id="shareBroadcastBtn">
                                <i class="fas fa-share-alt"></i> Share
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="recent-uploads" id="recentUploads" style="display: none;">
                    <h3><i class="fas fa-history"></i> Recent Uploads</h3>
                    <div class="recent-images" id="recentImages"></div>
                </div>

                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> How This Works</h3>
                    <ol>
                        <li>Click "Choose File" to select an image from your device</li>
                        <li>Click "Upload to Cloudinary" to send it to the cloud</li>
                        <li>The image will instantly appear in the broadcast area</li>
                        <li>Anyone viewing this page will see the image automatically</li>
                    </ol>
                    <div class="demo-note">
                        <p><strong>Testing Tip:</strong> Open this page in multiple browser tabs/windows to see the live broadcast effect.</p>
                        <button class="demo-btn" id="testBroadcastBtn">
                            <i class="fas fa-broadcast-tower"></i> Test Broadcast
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>Powered by <strong>Cloudinary</strong> • Cloud Name: <code>dcpqnmdas</code></p>
            <p class="footer-note">Uploaded images are stored in your Cloudinary account. They will persist based on your Cloudinary settings.</p>
        </footer>
    </div>

    <div id="notification" class="notification"></div>

    <!-- Add Firebase for real-time updates (optional but recommended) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>

        // script.js - Updated for Cloudinary with dcpqnmdas and preset 'stanslaus'
document.addEventListener('DOMContentLoaded', function() {
    // Your Cloudinary configuration - UPDATED WITH YOUR PRESET
    const cloudName = 'dcpqnmdas'; // Your Cloudinary cloud name
    const uploadPreset = 'stanslaus'; // Your upload preset name
    
    // DOM Elements
    const widgetUploadBtn = document.getElementById('widgetUploadBtn');
    const simpleUploadBtn = document.getElementById('simpleUploadBtn');
    const fileInput = document.getElementById('fileInput');
    const uploadWidgetArea = document.getElementById('uploadWidgetArea');
    const uploadPlaceholder = document.getElementById('uploadPlaceholder');
    const previewContainer = document.getElementById('previewContainer');
    const imagePreview = document.getElementById('imagePreview');
    const changeImageBtn = document.getElementById('changeImageBtn');
    const uploadSelectedBtn = document.getElementById('uploadSelectedBtn');
    const uploadDetails = document.getElementById('uploadDetails');
    const uploadStatus = document.getElementById('uploadStatus');
    const imageUrl = document.getElementById('imageUrl');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const cancelUploadBtn = document.getElementById('cancelUploadBtn');
    
    const currentImage = document.getElementById('currentImage');
    const imageDetails = document.getElementById('imageDetails');
    const uploadTime = document.getElementById('uploadTime');
    const imageDimensions = document.getElementById('imageDimensions');
    const imageSize = document.getElementById('imageSize');
    const imagePublicId = document.getElementById('imagePublicId');
    const copyUrlBtn = document.getElementById('copyUrlBtn');
    const openImageBtn = document.getElementById('openImageBtn');
    const shareBroadcastBtn = document.getElementById('shareBroadcastBtn');
    const refreshBroadcastBtn = document.getElementById('refreshBroadcastBtn');
    const testBroadcastBtn = document.getElementById('testBroadcastBtn');
    
    const notification = document.getElementById('notification');
    
    // State variables
    let currentImageData = null;
    let selectedFile = null;
    let uploadWidget = null;
    
    // Initialize Cloudinary Upload Widget with YOUR PRESET
    function initializeCloudinaryWidget() {
        uploadWidget = cloudinary.createUploadWidget({
            cloudName: cloudName,
            uploadPreset: uploadPreset, // This uses 'stan'
            sources: ['local', 'url', 'camera'],
            multiple: false,
            maxFileSize: 10000000, // 10MB
            clientAllowedFormats: ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'tiff'],
            showAdvancedOptions: false,
            cropping: false,
            resourceType: 'image',
            tags: ['broadcast', 'web-upload'],
            context: { alt: 'User uploaded broadcast image' }
        }, (error, result) => {
            if (!error && result && result.event === "success") {
                console.log('Upload successful!', result.info);
                handleUploadSuccess(result.info);
            } else if (error) {
                console.error('Upload error:', error);
                showNotification('Upload failed: ' + (error.message || 'Unknown error'), 'error');
                updateUploadStatus('Upload failed', 'error');
            }
            
            // Handle upload progress
            if (result && result.event === "upload-added") {
                updateUploadStatus('Uploading to Cloudinary...', 'uploading');
                uploadDetails.style.display = 'block';
            }
            
            if (result && result.event === "upload-progress") {
                const progress = result.info.progress;
                updateProgress(progress);
            }
            
            if (result && result.event === "abort") {
                showNotification('Upload cancelled', 'warning');
                resetUploadUI();
            }
        });
    }
    
    // Initialize the widget
    initializeCloudinaryWidget();
    
    // Event Listeners for upload methods
    widgetUploadBtn.addEventListener('click', () => {
        uploadWidget.open();
    });
    
    simpleUploadBtn.addEventListener('click', () => {
        fileInput.click();
    });
    
    fileInput.addEventListener('change', handleFileSelect);
    
    uploadWidgetArea.addEventListener('click', (e) => {
        if (e.target.closest('#uploadSelectedBtn') || e.target.closest('#changeImageBtn')) {
            return;
        }
        if (!selectedFile) {
            fileInput.click();
        }
    });
    
    // Handle drag and drop
    uploadWidgetArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadWidgetArea.style.borderColor = '#2ecc71';
        uploadWidgetArea.style.backgroundColor = '#f0fff4';
    });
    
    uploadWidgetArea.addEventListener('dragleave', () => {
        uploadWidgetArea.style.borderColor = '#4b6cb7';
        uploadWidgetArea.style.backgroundColor = 'white';
    });
    
    uploadWidgetArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadWidgetArea.style.borderColor = '#4b6cb7';
        uploadWidgetArea.style.backgroundColor = 'white';
        
        if (e.dataTransfer.files.length > 0) {
            handleFileSelect({ target: { files: e.dataTransfer.files } });
        }
    });
    
    changeImageBtn.addEventListener('click', () => {
        fileInput.click();
    });
    
    uploadSelectedBtn.addEventListener('click', uploadSelectedFile);
    cancelUploadBtn.addEventListener('click', cancelUpload);
    copyUrlBtn.addEventListener('click', copyImageUrl);
    openImageBtn.addEventListener('click', openImageFullSize);
    shareBroadcastBtn.addEventListener('click', shareBroadcast);
    refreshBroadcastBtn.addEventListener('click', refreshBroadcast);
    testBroadcastBtn.addEventListener('click', simulateBroadcast);
    
    // Handle file selection
    function handleFileSelect(event) {
        const files = event.target.files;
        if (files.length === 0) return;
        
        selectedFile = files[0];
        
        // Validate file
        const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/bmp', 'image/tiff'];
        if (!validTypes.includes(selectedFile.type)) {
            showNotification('Please select a valid image file (JPG, PNG, GIF, WebP, BMP, TIFF)', 'error');
            fileInput.value = '';
            selectedFile = null;
            return;
        }
        
        // Validate size (10MB max)
        if (selectedFile.size > 10 * 1024 * 1024) {
            showNotification('File size must be less than 10MB', 'error');
            fileInput.value = '';
            selectedFile = null;
            return;
        }
        
        // Show preview
        showImagePreview(selectedFile);
    }
    
    // Show image preview
    function showImagePreview(file) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            imagePreview.src = e.target.result;
            uploadPlaceholder.style.display = 'none';
            previewContainer.style.display = 'block';
        };
        
        reader.readAsDataURL(file);
    }
    
    // Upload selected file to Cloudinary with YOUR PRESET
    function uploadSelectedFile() {
        if (!selectedFile) {
            showNotification('Please select an image first', 'warning');
            return;
        }
        
        // Show upload details
        updateUploadStatus('Preparing upload...', 'uploading');
        uploadDetails.style.display = 'block';
        cancelUploadBtn.style.display = 'block';
        
        // Create FormData for upload - USING YOUR PRESET 'stan'
        const formData = new FormData();
        formData.append('file', selectedFile);
        formData.append('upload_preset', 'stanslaus'); // Your preset name
        formData.append('cloud_name', cloudName);
        
        // Upload to Cloudinary using fetch API
        const uploadUrl = `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`;
        
        const xhr = new XMLHttpRequest();
        
        xhr.upload.addEventListener('progress', (e) => {
            if (e.lengthComputable) {
                const percentComplete = Math.round((e.loaded / e.total) * 100);
                updateProgress(percentComplete);
                updateUploadStatus(`Uploading: ${percentComplete}%`, 'uploading');
            }
        });
        
        xhr.addEventListener('load', () => {
            if (xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                handleUploadSuccess(response);
            } else {
                console.error('Upload failed:', xhr.responseText);
                updateUploadStatus('Upload failed', 'error');
                showNotification('Upload failed. Please try again.', 'error');
            }
            cancelUploadBtn.style.display = 'none';
        });
        
        xhr.addEventListener('error', () => {
            updateUploadStatus('Upload failed', 'error');
            showNotification('Network error. Please check your connection.', 'error');
            cancelUploadBtn.style.display = 'none';
        });
        
        // For cancel functionality
        window.currentUploadXHR = xhr;
        
        xhr.open('POST', uploadUrl);
        xhr.send(formData);
    }
    
    // Cancel upload
    function cancelUpload() {
        if (window.currentUploadXHR) {
            window.currentUploadXHR.abort();
            resetUploadUI();
            showNotification('Upload cancelled', 'warning');
        }
    }
    
    // Reset upload UI
    function resetUploadUI() {
        selectedFile = null;
        fileInput.value = '';
        uploadPlaceholder.style.display = 'block';
        previewContainer.style.display = 'none';
        uploadDetails.style.display = 'none';
        cancelUploadBtn.style.display = 'none';
        updateProgress(0);
    }
    
    // Handle successful upload
    function handleUploadSuccess(imageInfo) {
        currentImageData = imageInfo;
        
        // Update upload status
        updateUploadStatus('Upload complete!', 'success');
        updateProgress(100);
        
        // Display image URL
        imageUrl.textContent = imageInfo.secure_url;
        imageUrl.title = imageInfo.secure_url;
        
        // Display the image
        displayImage(imageInfo);
        
        // Save to localStorage for broadcast simulation
        saveImageToBroadcast(imageInfo);
        
        // Show success notification
        showNotification('Image uploaded successfully! Broadcasting to all viewers...', 'success');
        
        // Reset upload UI
        resetUploadUI();
        
        console.log('Image uploaded with preset "stanslaus":', imageInfo.secure_url);
    }
    
    // Save image to broadcast (simulated)
    function saveImageToBroadcast(imageInfo) {
        const broadcastData = {
            imageInfo: imageInfo,
            timestamp: new Date().toISOString(),
            id: 'img_' + Date.now()
        };
        
        localStorage.setItem('broadcastImage', JSON.stringify(broadcastData));
        
        // Also save to recent uploads
        saveToRecentUploads(imageInfo);
    }
    
    // Save to recent uploads
    function saveToRecentUploads(imageInfo) {
        let recentUploads = JSON.parse(localStorage.getItem('recentUploads') || '[]');
        
        // Add new upload
        recentUploads.unshift({
            url: imageInfo.secure_url,
            thumbnail: imageInfo.secure_url.replace('/upload/', '/upload/w_200,h_150,c_fill/'),
            public_id: imageInfo.public_id,
            timestamp: new Date().toISOString()
        });
        
        // Keep only last 6
        if (recentUploads.length > 6) {
            recentUploads = recentUploads.slice(0, 6);
        }
        
        localStorage.setItem('recentUploads', JSON.stringify(recentUploads));
        displayRecentUploads(recentUploads);
    }
    
    // Display recent uploads
    function displayRecentUploads(uploads) {
        const recentImagesContainer = document.getElementById('recentImages');
        const recentUploadsSection = document.getElementById('recentUploads');
        
        if (uploads.length === 0) {
            recentUploadsSection.style.display = 'none';
            return;
        }
        
        recentUploadsSection.style.display = 'block';
        recentImagesContainer.innerHTML = '';
        
        uploads.forEach(upload => {
            const imgItem = document.createElement('div');
            imgItem.className = 'recent-image-item';
            imgItem.innerHTML = `<img src="${upload.thumbnail}" alt="Recent upload" data-url="${upload.url}">`;
            
            imgItem.addEventListener('click', () => {
                // Show this image in broadcast
                const fakeImageInfo = {
                    secure_url: upload.url,
                    public_id: upload.public_id,
                    created_at: upload.timestamp
                };
                displayImage(fakeImageInfo);
                showNotification('Displaying image from history', 'info');
            });
            
            recentImagesContainer.appendChild(imgItem);
        });
    }
    
    // Display the uploaded image
    function displayImage(imageInfo) {
        // Clear previous image
        currentImage.innerHTML = '';
        
        // Create image element
        const img = document.createElement('img');
        img.src = imageInfo.secure_url;
        img.alt = 'Broadcast image';
        img.style.maxWidth = '100%';
        img.style.maxHeight = '100%';
        img.style.objectFit = 'contain';
        
        // Add to container
        currentImage.appendChild(img);
        
        // Update image details
        updateImageDetails(imageInfo);
        
        // Show image details section
        imageDetails.style.display = 'block';
    }
    
    // Update image details
    function updateImageDetails(imageInfo) {
        // Format upload time
        const now = new Date();
        uploadTime.textContent = now.toLocaleTimeString() + ' ' + now.toLocaleDateString();
        
        // Set public ID
        imagePublicId.textContent = imageInfo.public_id || 'Unknown';
        
        // Try to get dimensions if available
        if (imageInfo.width && imageInfo.height) {
            imageDimensions.textContent = `${imageInfo.width} × ${imageInfo.height}`;
        } else {
            imageDimensions.textContent = 'Loading...';
            // Try to get dimensions from image
            const img = new Image();
            img.onload = function() {
                imageDimensions.textContent = `${this.width} × ${this.height}`;
            };
            img.src = imageInfo.secure_url;
        }
        
        // Format file size
        if (imageInfo.bytes) {
            const sizeInKB = (imageInfo.bytes / 1024).toFixed(1);
            imageSize.textContent = sizeInKB >= 1024 
                ? `${(imageInfo.bytes / (1024 * 1024)).toFixed(2)} MB` 
                : `${sizeInKB} KB`;
        } else {
            imageSize.textContent = 'Unknown';
        }
    }
    
    // Update upload status
    function updateUploadStatus(text, status) {
        uploadStatus.textContent = text;
        
        // Color code the status
        uploadStatus.className = '';
        if (status === 'success') {
            uploadStatus.classList.add('success');
        } else if (status === 'error') {
            uploadStatus.classList.add('error');
        } else if (status === 'uploading') {
            uploadStatus.classList.add('uploading');
        }
    }
    
    // Update progress bar
    function updateProgress(percent) {
        progressBar.style.width = percent + '%';
        progressText.textContent = percent + '%';
    }
    
    // Copy image URL to clipboard
    function copyImageUrl() {
        if (!currentImageData) return;
        
        navigator.clipboard.writeText(currentImageData.secure_url)
            .then(() => {
                showNotification('Image URL copied to clipboard!', 'success');
            })
            .catch(err => {
                console.error('Failed to copy: ', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = currentImageData.secure_url;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showNotification('URL copied to clipboard!', 'success');
                } catch (e) {
                    showNotification('Failed to copy URL', 'error');
                }
                document.body.removeChild(textArea);
            });
    }
    
    // Open image in new tab
    function openImageFullSize() {
        if (!currentImageData) return;
        
        window.open(currentImageData.secure_url, '_blank');
    }
    
    // Share broadcast
    function shareBroadcast() {
        if (!currentImageData) return;
        
        const shareText = `Check out this image broadcast: ${currentImageData.secure_url}`;
        
        if (navigator.share) {
            navigator.share({
                title: 'Image Broadcast',
                text: 'Check out this image!',
                url: currentImageData.secure_url,
            })
            .catch(err => console.log('Error sharing:', err));
        } else {
            copyImageUrl();
        }
    }
    
    // Refresh broadcast
    function refreshBroadcast() {
        // Check for new broadcast image
        checkForNewBroadcast();
        showNotification('Checking for new images...', 'info');
    }
    
    // Simulate broadcast (for testing)
    function simulateBroadcast() {
        const sampleImages = [
            {
                secure_url: `https://res.cloudinary.com/${cloudName}/image/upload/v${Date.now()}/sample.jpg`,
                public_id: 'sample_broadcast_1',
                bytes: 123456,
                width: 800,
                height: 600
            },
            {
                secure_url: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb',
                public_id: 'sample_broadcast_2',
                bytes: 234567,
                width: 1024,
                height: 768
            }
        ];
        
        const randomImage = sampleImages[Math.floor(Math.random() * sampleImages.length)];
        
        // Save to localStorage to simulate broadcast
        saveImageToBroadcast(randomImage);
        
        // Also display it
        displayImage(randomImage);
        
        showNotification('Test broadcast sent! Open another tab to see the effect.', 'success');
    }
    
    // Check for new broadcast images
    function checkForNewBroadcast() {
        const broadcastData = localStorage.getItem('broadcastImage');
        if (broadcastData) {
            try {
                const data = JSON.parse(broadcastData);
                if (currentImageData && data.imageInfo.public_id !== currentImageData.public_id) {
                    console.log('New broadcast image detected!');
                    currentImageData = data.imageInfo;
                    displayImage(data.imageInfo);
                    showNotification('New image received in broadcast!', 'success');
                }
            } catch (e) {
                console.error('Error parsing broadcast data:', e);
            }
        }
    }
    
    // Show notification
    function showNotification(message, type = 'info') {
        notification.textContent = message;
        notification.className = 'notification';
        notification.classList.add(type);
        notification.classList.add('show');
        
        // Hide after 4 seconds
        setTimeout(() => {
            notification.classList.remove('show');
        }, 4000);
    }
    
    // Load existing broadcast image on startup
    function loadInitialBroadcast() {
        const broadcastData = localStorage.getItem('broadcastImage');
        if (broadcastData) {
            try {
                const data = JSON.parse(broadcastData);
                currentImageData = data.imageInfo;
                displayImage(data.imageInfo);
                updateUploadStatus('Loaded from broadcast', 'success');
                showNotification('Loaded latest broadcast image', 'info');
            } catch (e) {
                console.error('Failed to load broadcast:', e);
            }
        }
        
        // Load recent uploads
        const recentUploads = JSON.parse(localStorage.getItem('recentUploads') || '[]');
        displayRecentUploads(recentUploads);
    }
    
    // Initialize
    loadInitialBroadcast();
    
    // Poll for new broadcast images (simulated real-time)
    setInterval(checkForNewBroadcast, 5000); // Check every 5 seconds
    
    // Add styles for status colors
    const style = document.createElement('style');
    style.textContent = `
        .success { color: #2ecc71 !important; }
        .error { color: #e74c3c !important; }
        .uploading { color: #3498db !important; }
    `;
    document.head.appendChild(style);
    
    // Log configuration for debugging
    console.log('Cloudinary Configuration:');
    console.log('- Cloud Name:', cloudName);
    console.log('- Upload Preset:', uploadPreset);
    console.log('- Upload URL:', `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`);
});
    </script>
</body>
</html>
